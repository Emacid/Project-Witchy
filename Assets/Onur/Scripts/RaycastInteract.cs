using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class RaycastInteract : MonoBehaviour
{
    public float interactDistance = 0.5f; // Interaksiyon mesafesi
    public LayerMask interactLayer; // Interaksiyon yapýlacak katmanlar
    public Color highlightColor; // Editörde belirlenecek renk

    private GameObject lastHitObject; // Son temas edilen nesne
    private Color originalColor; // Orijinal renk

    private Outline outlineOfObject;

    public string itemName = string.Empty;

    void Start()
    {
        originalColor = Color.white; // Varsayýlan renk
        outlineOfObject = null;
    }

    void Update()
    {
        Debug.Log(itemName);
        RaycastHit hit;
        if (Physics.Raycast(transform.position, transform.forward, out hit, interactDistance, interactLayer))
        {
            GameObject hitObject = hit.collider.gameObject;

            // Debug ray'ý çiz
            Debug.DrawRay(transform.position, transform.forward * interactDistance, Color.red);

            // Son temas edilen nesnenin rengini deðiþtirme
            if (lastHitObject != hitObject)
            {
                ResetLastHitObjectColor();
            }

            // Temas edilen nesnenin rengini deðiþtirme
            SpriteRenderer spriteRenderer = hitObject.GetComponent<SpriteRenderer>();
            Item itemScript = hitObject.GetComponentInParent<Item>(); // Item scriptini al

            if (spriteRenderer != null && spriteRenderer.color == highlightColor)
            {
                // Eðer belirlenen renk ise, pickable yap
                if (itemScript != null)
                {
                    itemScript.isPickable = true;
                    Debug.Log(hitObject.name + " is now pickable!");
                    outlineOfObject = hitObject.GetComponent<Outline>();
                    outlineOfObject.isLooking = true;

                    // itemName'i güncelle
                    itemName = spriteRenderer.sprite.name;
                }

            }
            else
            {
                //outlineOfObject.isLooking = false;

                // Belirlenen renk deðilse, pickable'ý false yap
                if (itemScript != null)
                {
                    itemScript.isPickable = false;
                }

                // itemName'i boþ yap
                itemName = string.Empty;
            }

            if (spriteRenderer != null)
            {
                spriteRenderer.color = highlightColor;
                lastHitObject = hitObject;
            }

        }
        else
        {
            // Eðer hiçbir nesne temas edilmiyorsa, son temas edilen nesnenin rengini sýfýrla
            ResetLastHitObjectColor();
            // Debug ray'ý çiz
            Debug.DrawRay(transform.position, transform.forward * interactDistance, Color.red);

            // itemName'i boþ yap
            itemName = string.Empty;
        }
    }

    // Son temas edilen nesnenin rengini sýfýrlama

    void ResetLastHitObjectColor()
    {
        if (lastHitObject != null)
        {
            SpriteRenderer lastSpriteRenderer = lastHitObject.GetComponent<SpriteRenderer>();
            if (lastSpriteRenderer != null)
            {
                // Orjinal rengine geri döndür
                lastSpriteRenderer.color = originalColor;
            }

            Item itemScript = lastHitObject.GetComponentInParent<Item>();
            if (itemScript != null)
            {
                // Pickable'ý false yap
                itemScript.isPickable = false;
            }

            outlineOfObject = lastHitObject.GetComponent<Outline>(); // outlineOfObject'i sýfýrla
            if (outlineOfObject != null)
            {
                outlineOfObject.isLooking = false; // outlineOfObject'i sýfýrla
            }

            lastHitObject = null;
        }
    }
}
